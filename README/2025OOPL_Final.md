# 2025 OOPL Final Report

## 一、組別資訊
組別：26

組員：112820022周佩樺、112590022陳駿逸

復刻遊戲：FE1 (Fire Emblem1) PC version

## 二、專案簡介

### 遊戲簡介
![](intro.png)
[Fire Emblem: Shadow Dragon and the Blade of Light (FE1)](https://serenesforest.net/shadow-dragon-and-blade-of-light/) 是 Fire Emblem 系列的第一部作品，屬於戰略角色扮演（SRPG）遊戲，由任天堂於1990年在FC紅白機上發行。
結合戰略遊戲的遊玩方式與角色扮演遊戲的劇情推演及人物成長，務求營造出昔日戰略遊戲中不存在的角色親近感。系列遊戲的每場戰鬥都在網格狀地圖上進行，戰鬥系統採用回合制，以我方、敵方、友方的排序進行回合交替，玩家可在故事主線和支線任務中控制一定數量角色。每個角色都有特定職業，它決定了角色的能力值並影響他們的攻擊範圍、移動距離等。部分職業具備獨有的先天技能，而角色的能力值及其升幅也各有不同。


### 組別分工
112820022周佩樺：素材處理、資訊UI製作、升級UI製作、測試 <br>
112590022陳駿逸：物件建置、武器管理、流程處理

## 三、遊戲介紹

![](game_cover.png)

### 遊戲規則
Marth是主角，遊戲目標是讓Marth到達城堡完成兩個關卡，而一旦HP歸零則敗北。
每位角色有職業、基礎數值、成長率、4個背包欄位，角色可以選擇背包裡的其中一個欄位作為手持欄位，而每個武器有基礎數值、攻擊距離。考慮大部分的玩家行為都是根據選擇來達成目的，因此之後的說明皆採用以下線性的狀態與流程來撰寫：

1. [⬆️⬇️➡️⬅️]：控制選擇框移動到對想操作的角色座標
2. [ENTER↩️]：選取該角色，該角色進入走路狀態
   - 藍色的tips是可行走的範圍（[職業地形成本對應表](class_cost.png)）
   - 紅色的tips是可攻擊最大範圍（根據角色背包所有武器）

3. [⬆️⬇️➡️⬅️]：控制選擇框移動到想讓角色移動到的座標（受限在藍色tips的範圍中）
4. 該角色移動到該座標（紅色tips表示當前可攻擊範圍）
5. 顯示當前角色可以做的所有動作（ActUI）
   - [⬆️⬇️]：操控選擇點移動
   - 5-1. [ENTER↩️] Next 選項：Marth到該關卡的城堡後出現，選擇進入下一關
   - 5-2. [ENTER↩️] Visit 選項：到特定村莊拜訪獲得錢錢、拜訪獲得Wry角色
   - 5-3. [ENTER↩️] Talk 選項：當Marth遇到敵人Darros、Caeda遇到敵人Castor可以將其變成我方角色
   - 5-4. [ENTER↩️] Armory 選項：當角色在商店時出現，選擇進入商店頁面（ShopUI）
     - [⬆️⬇️]：操控選擇點移動（可買的當前角色職業武器，若無則不會出現選擇點）
     - [ENTER↩️]：購買物品
     - [BACKSPACE↪️]：結束該回合該角色的行動
  
   - 5-5. [ENTER↩️] Attack 選項：當敵人在角色攻擊範圍內時出現，選擇進行敵人的選取
     - [⬆️⬇️➡️⬅️]：控制選擇框到要攻擊的敵人
     - 5-5-1. [ENTER↩️]：進入武器頁面（WeaponUI）
       - [⬆️⬇️]：操控選擇點移動
       - [ENTER↩️]：選取手持的攻擊武器
  
   - 5-6. [ENTER↩️] Target 選項：當隊友在角色有效範圍內時出現，選擇進行隊友的選取
     - 5-6-1. [ENTER↩️]：進入武器頁面（WeaponUI）
       - [⬆️⬇️]：操控選擇點移動
       - [ENTER↩️]：選取手持的Heal

   - 5-7. [ENTER↩️] Item 選項：進入背包頁面（ItemUI）
     - [⬆️⬇️]：操控選擇點移動
     - [ENTER↩️]：選取手持物品並回到ActUI
     - [SPACE⏹️]：捨棄物品

   - 5-8. [ENTER↩️] Wait 選項：結束該回合該角色的行動
6. 當所有我方角色移動完後換敵人回合行動
7. 敵人優先攻擊Marth或是血量較少者

[F1] : 顯示/隱藏 地形資訊（TileInfoUI）<br>
[F2] : 顯示/隱藏 角色詳情資訊（CharacterInfoFullUI）<br>
[F3] : 顯示/隱藏 角色武器資訊（ItemInfoUI），[Q]可以換下一把武器<br>
[F4] : 顯示/隱藏 角色移動提示（Tips in PlayerManager）<br>

[0️⃣]：結束玩家移動回合 <br>
[1️⃣]：開/關 敵人的移動（作弊鍵）<br>

---

攻擊規則：<br>
攻擊角色的武器如果對被攻擊角色的職業克制則享有三被傷害，攻擊角色有機率觸發爆擊，被攻擊的角色有機率觸發閃避。假設A角色先攻擊B角色，接著B角色可以根據手持的武器進行反擊，若A的行動速度（速度值-武器重量）比B快，A可獲得一次追擊，反之，若B的行動速度比A快，B可獲得一次追擊。

經驗與升級規則：<br>
角色擊殺敵方橘色後會獲得對方身上的Exp經驗值，每獲得100Exp升一等Lv等級，每升一等每個基礎數值會根據該數值的成長機率上升1點。e.g.當Marth等級提升時的HP上限+1的機率是90%、Str+1的機率是50%......以此類推。

### 遊戲畫面
|||
|---|---|
|![](Moving.png)|![](ActUI.png)|
|![](ShopUI.png)|![](LevelUp.png)|
|![](BattleUI.png)|![](End.png)|
|![](Dead.png)||

## 四、程式設計

### 程式架構
![](Structure.png)
從結構上可以分成：
 - MapManager -> 管理有關地圖上的所有Tile(磚塊)
 - UIManager -> 管理所有視窗UI
 - PlayerManager -> 管理所有我方角色Character
 - EnemyManager -> 管理所有敵方角色Character
 - Camera -> 管理所有顯示到render的物件
 - Selection -> 玩家操作的選擇框，包含狀態機
 - ProcessControl -> 用來整理狀態機線性流程的程式
### 程式技術
根據SelectionStatus的狀態大概操作：
  1. Normal to Moving：
     - 紀錄選擇的角色
     - 角色更改成行走狀態
     - 對比"角色移動花費列表"使用BFS廣度優先搜尋尋找可行走範圍
     - 由可行走範圍和角色所有武器的觸及範圍BFS尋找攻擊範圍
     - 顯示範圍提示Tips（由半透明的Tile組成，管理在PlayerManager）

  2. Moving to Walking：
     - 使用Dijkstra計算最短距離放到移動堆疊裡
     - 一旦角色堆疊裡有座標，將座標距離分段，每幀移動一段
     - 到堆疊座標即pop，一旦堆疊變成空的即觸發步驟3
  
  3. SUI(ActUI繼承SelectedUI)：<br>
     - 以角色當前座標為原點BFS尋找攻擊範圍
     - 判斷角色是否觸發選項
     - 根據選項
       - 上下左右移動鍵以最短可移動座標選取
       - AttackTargeting/Targeting/ItemUI/ShopUI
  
  4. AttackTargeting/Targeting to WeaponUI/HUI
     - 選擇判斷武器距離等於敵人距離的武器
     - 將武器設定成手持
  
  5. WeaponUI/HUI to BattleUI
     - 每幀更新動畫與邏輯操作
  
  6. BattleUI to Normal
     - 關掉BattleUI
     - 把角色設定成Waiting
  
  7. ItemUI to Normal
     - 設定當前手持武器
     - 刪除武器

  8. ShopUI to Normal
     - 配合可使用列表限制可購買的選項
     - 選擇後扣錢並替代nill欄位
  
  9. EnemyMoving
     - 根據敵人列表移動
     - 角色更改成行走狀態
     - 對比"角色移動花費列表"使用BFS廣度優先搜尋尋找可行走範圍
     - 由可行走範圍和角色所有武器的觸及範圍BFS尋找攻擊範圍
     - 若攻擊與移動範圍內有我方角色，挑選Marth或是血量最低者攻擊
     - 若無我方角色，使用A*尋找與Marth的最短成本路徑，根據路徑和可移動範圍重疊位置挑最遠的點進行移動

## 五、結語


### 問題與解決方法

### 自評


| 項次 | 項目                   | 完成 |
|------|------------------------|-------|
| 1    | 這是範例 |  V  |
| 2    | 完成專案權限改為 public |    |
| 3    | 具有 debug mode 的功能  |    |
| 4    | 解決專案上所有 Memory Leak 的問題  |    |
| 5    | 報告中沒有任何錯字，以及沒有任何一項遺漏  |    |
| 6    | 報告至少保持基本的美感，人類可讀  |    |

### 心得
### 貢獻比例